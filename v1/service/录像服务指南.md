# 录像服务指南


### 简介：

当您使用anyRTC的音视频功能时，还可以通过对录像功能的设置来获取视频的录像以及是否需要录像。当您使用该功能的前提是您已经在anyRTC平台创建了应用，目前提供录像的服务有视频会议。

录像服务指视频录像，可在用户后台设置录像回调地址和是否自动录像

### 自动录像：
在用户后台登录后，在应用管理中选择您的应用，在服务列表中选择需要录像的服务。
当您选择自动录像时，您进行的每一次会议都会录像。
当您选择手动录制时，anyRTC提供开始和结束录像的接口实现对录像的控制。


##### 开始录像：

GET 请求
```
http://www.anyrtc.io/anyapi/v1/startrecord?AppID=your.appid&ArRoomID=your.roomid&Type=Meet
```

URL参数：
| 编号 | 参数 | 名称 | 类型 | 说明 |
|--- | --- | --- | --- | --- |
| 1 | AppId | 应用ID | string | 在应用信息中获取 |
| 2 | ArRoomID | 房间名称 | string | sdk中加入房间时的anyrtcid |
| 3 | Type | 房间类型 | string | 会议的录像默认值为Meet，区分大小写 |

body参数：
| 编号 | 参数 | 名称 | 类型 | 说明 |
| --- | --- | --- | --- | --- |
| 1 | Path | 路径 | string | 在服务器中的相对存储路径 |
| 2 | UserData | 用户自定义数据 | string | 用户自定义的数据，字符串类型，如果自定义数据为json对象，请转为json 字符串 |
| 3 | NameRule | 命名规则 | string | "ar_{roomid}_{date}_{random}"，至少携带两级下划线，以避免和其他用户冲突 |

###### 命名规则说明：

例如： 
```
xx_{random}_{date}_{time}_{roomid}_{userid}_xx.mp4
 {random}: 4位随机字符串数字+字母
 {date}: 日期-年月日 20180912
 {time}: 时间-秒数
 {roomid}: 房间ID
 {userid}: 用户ID - 只适用于单独的音视频,合成音视频此参数无效
最多支持5个自定义参数，如果您不需要或没有，可以不填。比如这样的名称xx_{random}_{date}_{roomid}_xx.mp4，也是有效的。该自定义名称会在录像回调中返回给您。
```

返回值
```
{"result":"ok"}
```
该返回值为josn类型字符串，需要json解析

| 名称 | 说明 |
| --- | --- |
| result | ok为成功，其他值均为失败 |



##### 结束录像：
```
http://www.anyrtc.io/anyapi/v1/stoprecord?AppID=your.appid&ArRoomID=your.roomid&Type=Meet
```

| 编号 | 参数 | 名称 | 类型 | 说明 |
| --- | --- | --- | --- | --- |
| 1 | AppId | 应用ID | string | 在应用信息中获取 |
| 2 | ArRoomID | 房间名称 | string | sdk中加入房间时的anyrtcid |
| 3 | Type | 房间类型 | string | 会议的录像默认值为Meet，区分大小写 |

返回值
```
{"result":"ok"}
```
该返回值为josn类型字符串，需要json解析

| 名称 | 说明 |
| --- | --- |
| result | ok为成功，其他值均为失败 |


### 回调地址：
该地址由第三方集成方提供，anyRTC平台服务来调用
POST 请求
```
http://your.server.domain:port/AR/V1/av
```

body 参数：
| 编号 | 参数 | 名称 | 类型 | 说明 |
| --- | --- | --- | --- | --- |
| 1 | type | 业务类型 | string | "1":会议录像/会议合成录像;"2":单独每路的录像;"3"：提取帧图像 |
| 2 | mediaType | 媒体类型 | string | audio:音频;video:视频;image:图片 |
| 3 | userId | 用户ID | string | 用户ID，在sdk中加入房间时的userid |
| 4 | groupId | 房间ID | string | 房间ID，在sdk中加入房间时的anyrtcid |
| 5 | fileName | 文件名称 | string | 录像文件的名称，在开始录像接口传入的参数。如果您使用了自动录像，则该值为随机字符串 |
| 6 | fileSize | 文件大小 | int | 录像文件的大小，单位byte |
| 7 | duration | 文件时长 | int | 录像文件的市场，单位秒 |
| 8 | startTime | 开始时间 | string | 会议开始时间，日期格式字符串 |
| 9 | endTime | 结束时间 | string | 会议结束时间，日期格式字符串 |
| 10 | downloadUrl | 下载地址 | string | 视频下载地址，http请求 |
| 11 | userData | 用户自定义数据 | json string | 用户自定义数据，在开始录像接口传入的参数，json格式的字符串 |

例如：
```
{
    "type":"2",
    "mediaType":"audio/video",
    "userId":"123456",
    "groupId":"123888",
    "startTime":"2018-3-21 13:06:27",
    "endTime":"2018-3-21 13:06:47",
    "fileName":"yyy.mp4",
    "fileSize":65322,
    "duration":20,
    "downloadUrl":"http://www.anyrtc.io/yyy.mp4",
    "userData":"{\"customerCode\":\"1002\",\"devCoder\":\"10006\",\"uNamer\":\"李席\",\"devCoded\":\"10008\",\"uNamed\":\"王伟\",\"nIder\":\"1005\",\"nNamer\":\"电务段\",\"nIded\":\"1006\",\"nNamed\":\"工务段\"}"
}
```

返回值：
```
{"success": "true","message":"返回结果说明"}
```
该返回值为josn类型字符串，需要json解析

| 名称 | 说明 |
| --- | --- |
| success | true为成功，false为失败 |
| message | 返回结果的说明 |